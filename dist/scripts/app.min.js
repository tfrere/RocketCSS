
angular.module('toggleHeight',[]).directive('toggleChildHeight',function($window){return{scope:{index:'@'},link:function(scope,element,attrs){var w=angular.element($window);var linkHeight=angular.element(element)[0].offsetHeight;element.parent().css({height:linkHeight});element.bind('click',function(){element.parent().toggleClass('active');element.find("i").toggleClass('active');var actualHeight=angular.element(element.parent())[0].offsetHeight;var contentHeight=angular.element(element.next())[0].offsetHeight+40;var totalHeight=linkHeight+contentHeight;if(totalHeight==actualHeight){element.parent().css({height:linkHeight});}
else{window.analytics.track('question '+attrs.index);element.parent().css({height:totalHeight});}});w.bind('resize',function(){var linkHeight=angular.element(element)[0].offsetHeight;element.parent().css({height:linkHeight});element.bind('click',function(){console.log(element.parent());element.parent().toggleClass('active');var actualHeight=angular.element(element.parent())[0].offsetHeight;var contentHeight=angular.element(element.next())[0].offsetHeight+40;var totalHeight=linkHeight+contentHeight;if(totalHeight==actualHeight)
element.parent().css({height:linkHeight});else
element.parent().css({height:totalHeight});});});}};});(function(){angular.module('ngWheel',[]).directive('ngScroll',['$parse',function($parse){return function(scope,element,attr){var fn=$parse(attr.ngScroll);console.log('scroll!');element.bind('scroll',function(event){console.log('scroll!');scope.$apply(function(){fn(scope,{$event:event});});});};}]);}.call(this));angular.module('duParallax',['duScroll','duParallax.directive','duParallax.helper']);angular.module('duParallax.helper',[]).factory('parallaxHelper',function(){function createAnimator(factor,max,min,offset){return function(params){var delta=factor*((offset||0)+params.elemY);if(angular.isNumber(max)&&delta>max)return max;if(angular.isNumber(min)&&delta<min)return min;return delta;};}
return{createAnimator:createAnimator,background:createAnimator(-0.3,150,-30,50)};});angular.module('duParallax.directive',['duScroll']).directive('duParallax',["$rootScope","$window","$document",function($rootScope,$window,$document){var test=angular.element('<div></div>')[0];var prefixes='transform WebkitTransform MozTransform OTransform'.split(' ');var transformProperty;for(var i=0;i<prefixes.length;i++){if(test.style[prefixes[i]]!==undefined){transformProperty=prefixes[i];break;}}
if(!transformProperty){return;}
var translate3d=function(result){if(!result.x&&!result.y)return'';return'translate3d('+Math.round(result.x)+'px, '+Math.round(result.y)+'px, 0)';};var rotate=function(result){if(!result.rotation)return'';return' rotate('+(angular.isNumber(result.rotation)?Math.round(result.rotation)+'deg':result.rotation)+')';};var applyProperties=function(result,element){element.style[transformProperty]=translate3d(result)+rotate(result);element.style.opacity=result.opacity;if(result.custom){for(var property in result.custom){element.style[property]=result.custom[property];}}};return{scope:{y:'=',x:'=',rotation:'=',opacity:'=',custom:'='},link:function($scope,$element,$attr){var element=$element[0];var currentProperties;var inited=false;var onScroll=function(){var scrollY=$document.scrollTop();var rect=element.getBoundingClientRect();if(!inited){inited=true;angular.element($window).on('load',function init(){var i=0;var maxIterations=10;var currentY=rect.top;var lastY;do{lastY=currentY;onScroll();currentY=element.getBoundingClientRect().top;i++;}while(i<maxIterations&&lastY!==currentY);});}
var param={scrollY:scrollY,elemX:rect.left,elemY:rect.top};var properties={x:0,y:0,rotation:0,opacity:1,custom:undefined};for(var key in properties){if(angular.isFunction($scope[key])){properties[key]=$scope[key](param);}else if($scope[key]){properties[key]=$scope[key];}}
var hasChange=angular.isUndefined(currentProperties);if(!hasChange){for(key in properties){if(properties[key]!==currentProperties[key]){hasChange=true;break;}}}
if(hasChange){applyProperties(properties,element);currentProperties=properties;}};$document.on('scroll touchmove',onScroll).triggerHandler('scroll');$scope.$on('$destroy',function(){$document.off('scroll touchmove',onScroll);});}};}]);var duScrollDefaultEasing=function(x){'use strict';if(x<0.5){return Math.pow(x*2,2)/2;}
return 1-Math.pow((1-x)*2,2)/2;};var duScroll=angular.module('duScroll',['duScroll.scrollspy','duScroll.smoothScroll','duScroll.scrollContainer','duScroll.spyContext','duScroll.scrollHelpers']).value('duScrollDuration',350).value('duScrollSpyWait',100).value('duScrollGreedy',false).value('duScrollOffset',0).value('duScrollEasing',duScrollDefaultEasing).value('duScrollCancelOnEvents','scroll mousedown mousewheel touchmove keydown').value('duScrollBottomSpy',false).value('duScrollActiveClass','active');if(typeof module!=='undefined'&&module&&module.exports){module.exports=duScroll;}
angular.module('duScroll.scrollHelpers',['duScroll.requestAnimation']).run(["$window","$q","cancelAnimation","requestAnimation","duScrollEasing","duScrollDuration","duScrollOffset","duScrollCancelOnEvents",function($window,$q,cancelAnimation,requestAnimation,duScrollEasing,duScrollDuration,duScrollOffset,duScrollCancelOnEvents){'use strict';var proto={};var isDocument=function(el){return(typeof HTMLDocument!=='undefined'&&el instanceof HTMLDocument)||(el.nodeType&&el.nodeType===el.DOCUMENT_NODE);};var isElement=function(el){return(typeof HTMLElement!=='undefined'&&el instanceof HTMLElement)||(el.nodeType&&el.nodeType===el.ELEMENT_NODE);};var unwrap=function(el){return isElement(el)||isDocument(el)?el:el[0];};proto.duScrollTo=function(left,top,duration,easing){var aliasFn;if(angular.isElement(left)){aliasFn=this.duScrollToElement;}else if(angular.isDefined(duration)){aliasFn=this.duScrollToAnimated;}
if(aliasFn){return aliasFn.apply(this,arguments);}
var el=unwrap(this);if(isDocument(el)){return $window.scrollTo(left,top);}
el.scrollLeft=left;el.scrollTop=top;};var scrollAnimation,deferred;proto.duScrollToAnimated=function(left,top,duration,easing){if(duration&&!easing){easing=duScrollEasing;}
var startLeft=this.duScrollLeft(),startTop=this.duScrollTop(),deltaLeft=Math.round(left-startLeft),deltaTop=Math.round(top-startTop);var startTime=null,progress=0;var el=this;var cancelScrollAnimation=function($event){if(!$event||(progress&&$event.which>0)){if(duScrollCancelOnEvents){el.unbind(duScrollCancelOnEvents,cancelScrollAnimation);}
cancelAnimation(scrollAnimation);deferred.reject();scrollAnimation=null;}};if(scrollAnimation){cancelScrollAnimation();}
deferred=$q.defer();if(duration===0||(!deltaLeft&&!deltaTop)){if(duration===0){el.duScrollTo(left,top);}
deferred.resolve();return deferred.promise;}
var animationStep=function(timestamp){if(startTime===null){startTime=timestamp;}
progress=timestamp-startTime;var percent=(progress>=duration?1:easing(progress/duration));el.scrollTo(startLeft+Math.ceil(deltaLeft*percent),startTop+Math.ceil(deltaTop*percent));if(percent<1){scrollAnimation=requestAnimation(animationStep);}else{if(duScrollCancelOnEvents){el.unbind(duScrollCancelOnEvents,cancelScrollAnimation);}
scrollAnimation=null;deferred.resolve();}};el.duScrollTo(startLeft,startTop);if(duScrollCancelOnEvents){el.bind(duScrollCancelOnEvents,cancelScrollAnimation);}
scrollAnimation=requestAnimation(animationStep);return deferred.promise;};proto.duScrollToElement=function(target,offset,duration,easing){var el=unwrap(this);if(!angular.isNumber(offset)||isNaN(offset)){offset=duScrollOffset;}
var top=this.duScrollTop()+unwrap(target).getBoundingClientRect().top-offset;if(isElement(el)){top-=el.getBoundingClientRect().top;}
return this.duScrollTo(0,top,duration,easing);};proto.duScrollLeft=function(value,duration,easing){if(angular.isNumber(value)){return this.duScrollTo(value,this.duScrollTop(),duration,easing);}
var el=unwrap(this);if(isDocument(el)){return $window.scrollX||document.documentElement.scrollLeft||document.body.scrollLeft;}
return el.scrollLeft;};proto.duScrollTop=function(value,duration,easing){if(angular.isNumber(value)){return this.duScrollTo(this.duScrollLeft(),value,duration,easing);}
var el=unwrap(this);if(isDocument(el)){return $window.scrollY||document.documentElement.scrollTop||document.body.scrollTop;}
return el.scrollTop;};proto.duScrollToElementAnimated=function(target,offset,duration,easing){return this.duScrollToElement(target,offset,duration||duScrollDuration,easing);};proto.duScrollTopAnimated=function(top,duration,easing){return this.duScrollTop(top,duration||duScrollDuration,easing);};proto.duScrollLeftAnimated=function(left,duration,easing){return this.duScrollLeft(left,duration||duScrollDuration,easing);};angular.forEach(proto,function(fn,key){angular.element.prototype[key]=fn;var unprefixed=key.replace(/^duScroll/,'scroll');if(angular.isUndefined(angular.element.prototype[unprefixed])){angular.element.prototype[unprefixed]=fn;}});}]);angular.module('duScroll.polyfill',[]).factory('polyfill',["$window",function($window){'use strict';var vendors=['webkit','moz','o','ms'];return function(fnName,fallback){if($window[fnName]){return $window[fnName];}
var suffix=fnName.substr(0,1).toUpperCase()+fnName.substr(1);for(var key,i=0;i<vendors.length;i++){key=vendors[i]+suffix;if($window[key]){return $window[key];}}
return fallback;};}]);angular.module('duScroll.requestAnimation',['duScroll.polyfill']).factory('requestAnimation',["polyfill","$timeout",function(polyfill,$timeout){'use strict';var lastTime=0;var fallback=function(callback,element){var currTime=new Date().getTime();var timeToCall=Math.max(0,16-(currTime-lastTime));var id=$timeout(function(){callback(currTime+timeToCall);},timeToCall);lastTime=currTime+timeToCall;return id;};return polyfill('requestAnimationFrame',fallback);}]).factory('cancelAnimation',["polyfill","$timeout",function(polyfill,$timeout){'use strict';var fallback=function(promise){$timeout.cancel(promise);};return polyfill('cancelAnimationFrame',fallback);}]);angular.module('duScroll.spyAPI',['duScroll.scrollContainerAPI']).factory('spyAPI',["$rootScope","$timeout","$window","$document","scrollContainerAPI","duScrollGreedy","duScrollSpyWait","duScrollBottomSpy","duScrollActiveClass",function($rootScope,$timeout,$window,$document,scrollContainerAPI,duScrollGreedy,duScrollSpyWait,duScrollBottomSpy,duScrollActiveClass){'use strict';var createScrollHandler=function(context){var timer=false,queued=false;var handler=function(){queued=false;var container=context.container,containerEl=container[0],containerOffset=0,bottomReached;if(typeof HTMLElement!=='undefined'&&containerEl instanceof HTMLElement||containerEl.nodeType&&containerEl.nodeType===containerEl.ELEMENT_NODE){containerOffset=containerEl.getBoundingClientRect().top;bottomReached=Math.round(containerEl.scrollTop+containerEl.clientHeight)>=containerEl.scrollHeight;}else{bottomReached=Math.round($window.pageYOffset+$window.innerHeight)>=$document[0].body.scrollHeight;}
var compareProperty=(duScrollBottomSpy&&bottomReached?'bottom':'top');var i,currentlyActive,toBeActive,spies,spy,pos;spies=context.spies;currentlyActive=context.currentlyActive;toBeActive=undefined;for(i=0;i<spies.length;i++){spy=spies[i];pos=spy.getTargetPosition();if(!pos)continue;if((duScrollBottomSpy&&bottomReached)||(pos.top+spy.offset-containerOffset<20&&(duScrollGreedy||pos.top*-1+containerOffset)<pos.height)){if(!toBeActive||toBeActive[compareProperty]<pos[compareProperty]){toBeActive={spy:spy};toBeActive[compareProperty]=pos[compareProperty];}}}
if(toBeActive){toBeActive=toBeActive.spy;}
if(currentlyActive===toBeActive||(duScrollGreedy&&!toBeActive))return;if(currentlyActive){currentlyActive.$element.removeClass(duScrollActiveClass);$rootScope.$broadcast('duScrollspy:becameInactive',currentlyActive.$element,angular.element(currentlyActive.getTargetElement()));}
if(toBeActive){toBeActive.$element.addClass(duScrollActiveClass);$rootScope.$broadcast('duScrollspy:becameActive',toBeActive.$element,angular.element(toBeActive.getTargetElement()));}
context.currentlyActive=toBeActive;};if(!duScrollSpyWait){return handler;}
return function(){if(!timer){handler();timer=$timeout(function(){timer=false;if(queued){handler();}},duScrollSpyWait,false);}else{queued=true;}};};var contexts={};var createContext=function($scope){var id=$scope.$id;var context={spies:[]};context.handler=createScrollHandler(context);contexts[id]=context;$scope.$on('$destroy',function(){destroyContext($scope);});return id;};var destroyContext=function($scope){var id=$scope.$id;var context=contexts[id],container=context.container;if(container){container.off('scroll',context.handler);}
delete contexts[id];};var defaultContextId=createContext($rootScope);var getContextForScope=function(scope){if(contexts[scope.$id]){return contexts[scope.$id];}
if(scope.$parent){return getContextForScope(scope.$parent);}
return contexts[defaultContextId];};var getContextForSpy=function(spy){var context,contextId,scope=spy.$scope;if(scope){return getContextForScope(scope);}
for(contextId in contexts){context=contexts[contextId];if(context.spies.indexOf(spy)!==-1){return context;}}};var isElementInDocument=function(element){while(element.parentNode){element=element.parentNode;if(element===document){return true;}}
return false;};var addSpy=function(spy){var context=getContextForSpy(spy);if(!context)return;context.spies.push(spy);if(!context.container||!isElementInDocument(context.container)){if(context.container){context.container.off('scroll',context.handler);}
context.container=scrollContainerAPI.getContainer(spy.$scope);context.container.on('scroll',context.handler).triggerHandler('scroll');}};var removeSpy=function(spy){var context=getContextForSpy(spy);if(spy===context.currentlyActive){$rootScope.$broadcast('duScrollspy:becameInactive',context.currentlyActive.$element);context.currentlyActive=null;}
var i=context.spies.indexOf(spy);if(i!==-1){context.spies.splice(i,1);}
spy.$element=null;};return{addSpy:addSpy,removeSpy:removeSpy,createContext:createContext,destroyContext:destroyContext,getContextForScope:getContextForScope};}]);angular.module('duScroll.scrollContainerAPI',[]).factory('scrollContainerAPI',["$document",function($document){'use strict';var containers={};var setContainer=function(scope,element){var id=scope.$id;containers[id]=element;return id;};var getContainerId=function(scope){if(containers[scope.$id]){return scope.$id;}
if(scope.$parent){return getContainerId(scope.$parent);}
return;};var getContainer=function(scope){var id=getContainerId(scope);return id?containers[id]:$document;};var removeContainer=function(scope){var id=getContainerId(scope);if(id){delete containers[id];}};return{getContainerId:getContainerId,getContainer:getContainer,setContainer:setContainer,removeContainer:removeContainer};}]);angular.module('duScroll.smoothScroll',['duScroll.scrollHelpers','duScroll.scrollContainerAPI']).directive('duSmoothScroll',["duScrollDuration","duScrollOffset","scrollContainerAPI",function(duScrollDuration,duScrollOffset,scrollContainerAPI){'use strict';return{link:function($scope,$element,$attr){$element.on('click',function(e){if((!$attr.href||$attr.href.indexOf('#')===-1)&&$attr.duSmoothScroll==='')return;var id=$attr.href?$attr.href.replace(/.*(?=#[^\s]+$)/,'').substring(1):$attr.duSmoothScroll;var target=document.getElementById(id)||document.getElementsByName(id)[0];if(!target||!target.getBoundingClientRect)return;if(e.stopPropagation)e.stopPropagation();if(e.preventDefault)e.preventDefault();var offset=$attr.offset?parseInt($attr.offset,10):duScrollOffset;var duration=$attr.duration?parseInt($attr.duration,10):duScrollDuration;var container=scrollContainerAPI.getContainer($scope);container.duScrollToElement(angular.element(target),isNaN(offset)?0:offset,isNaN(duration)?0:duration);});}};}]);angular.module('duScroll.spyContext',['duScroll.spyAPI']).directive('duSpyContext',["spyAPI",function(spyAPI){'use strict';return{restrict:'A',scope:true,compile:function compile(tElement,tAttrs,transclude){return{pre:function preLink($scope,iElement,iAttrs,controller){spyAPI.createContext($scope);}};}};}]);angular.module('duScroll.scrollContainer',['duScroll.scrollContainerAPI']).directive('duScrollContainer',["scrollContainerAPI",function(scrollContainerAPI){'use strict';return{restrict:'A',scope:true,compile:function compile(tElement,tAttrs,transclude){return{pre:function preLink($scope,iElement,iAttrs,controller){iAttrs.$observe('duScrollContainer',function(element){if(angular.isString(element)){element=document.getElementById(element);}
element=(angular.isElement(element)?angular.element(element):iElement);scrollContainerAPI.setContainer($scope,element);$scope.$on('$destroy',function(){scrollContainerAPI.removeContainer($scope);});});}};}};}]);angular.module('duScroll.scrollspy',['duScroll.spyAPI']).directive('duScrollspy',["spyAPI","duScrollOffset","$timeout","$rootScope",function(spyAPI,duScrollOffset,$timeout,$rootScope){'use strict';var Spy=function(targetElementOrId,$scope,$element,offset){if(angular.isElement(targetElementOrId)){this.target=targetElementOrId;}else if(angular.isString(targetElementOrId)){this.targetId=targetElementOrId;}
this.$scope=$scope;this.$element=$element;this.offset=offset;};Spy.prototype.getTargetElement=function(){if(!this.target&&this.targetId){this.target=document.getElementById(this.targetId)||document.getElementsByName(this.targetId)[0];}
return this.target;};Spy.prototype.getTargetPosition=function(){var target=this.getTargetElement();if(target){return target.getBoundingClientRect();}};Spy.prototype.flushTargetCache=function(){if(this.targetId){this.target=undefined;}};return{link:function($scope,$element,$attr){var href=$attr.ngHref||$attr.href;var targetId;if(href&&href.indexOf('#')!==-1){targetId=href.replace(/.*(?=#[^\s]+$)/,'').substring(1);}else if($attr.duScrollspy){targetId=$attr.duScrollspy;}else if($attr.duSmoothScroll){targetId=$attr.duSmoothScroll;}
if(!targetId)return;var timeoutPromise=$timeout(function(){var spy=new Spy(targetId,$scope,$element,-($attr.offset?parseInt($attr.offset,10):duScrollOffset));spyAPI.addSpy(spy);$scope.$on('$locationChangeSuccess',spy.flushTargetCache.bind(spy));var deregisterOnStateChange=$rootScope.$on('$stateChangeSuccess',spy.flushTargetCache.bind(spy));$scope.$on('$destroy',function(){spyAPI.removeSpy(spy);deregisterOnStateChange();});},0,false);$scope.$on('$destroy',function(){$timeout.cancel(timeoutPromise);});}};}]);(function(){angular.module('ngTranslateSelect',[]).directive('ngTranslateLanguageSelect',function($stateParams,LocaleService){'use strict';return{restrict:'A',replace:true,template:''+'<div class="select select-noimage">'+'<select class="uppercase" ng-init="currentLocaleDisplayName = currentLocaleFromUrl" ng-model="currentLocaleDisplayName"'+'ng-options="localesDisplayName for localesDisplayName in localesDisplayNames"'+'ng-change="changeLanguage(currentLocaleDisplayName)">'+'<option value="" selected hidden />'+'</select>'+'</div>'+'',controller:function($cookies,$translate,$scope,$timeout,$rootScope,$stateParams,$state){if($stateParams.lang=="en")
LocaleService.setLocaleByDisplayName($stateParams.lang);else
LocaleService.setLocaleByDisplayName("fr");$timeout(function(){if($stateParams.lang=="en")
$scope.currentLocaleFromUrl=$stateParams.lang;else
$scope.currentLocaleFromUrl="fr";$scope.currentLocaleDisplayName=LocaleService.getLocaleDisplayName();$scope.localesDisplayNames=LocaleService.getLocalesDisplayNames();$scope.visible=$scope.localesDisplayNames&&$scope.localesDisplayNames.length>1;$scope.changeLanguage=function(locale){console.log("UPDATED LOCALE from directive",locale);$state.go($state.current.name,{lang:locale});};});}};});}.call(this));var app=angular.module('app',['ngSanitize','ngTranslateSelect','pascalprecht.translate','tmh.dynamicLocale','ngCookies','ui.router','ng-optimizely','duScroll','duParallax','toggleHeight','ngResource','ngAnimate']);app.constant('LOCALES',{'locales':{'fr':'fr','en':'en'},'preferredLocale':'fr'});app.config(function($translateProvider){$translateProvider.useMissingTranslationHandlerLog();});app.config(function($translateProvider){$translateProvider.useStaticFilesLoader({prefix:'ressources/locale-',suffix:'.json'});$translateProvider.useSanitizeValueStrategy('sanitize');$translateProvider.preferredLanguage('fr');$translateProvider.useLocalStorage();});app.config(function(tmhDynamicLocaleProvider){tmhDynamicLocaleProvider.localeLocationPattern('bower_components/angular-i18n/angular-locale_{{locale}}.js');});app.directive('compileUnsafe',function($compile){return function(scope,element,attr){scope.$watch(attr.compileUnsafe,function(val,oldVal){if(!val||(val===oldVal&&element[0].innerHTML))return;element.html(val);$compile(element)(scope);});};});app.run(['optimizely',function(optimizely){optimizely.loadProject('3529320510');}]);app.config(function($httpProvider){$httpProvider.defaults.useXDomain=true;delete $httpProvider.defaults.headers.common['X-Requested-With'];});app.directive('updateTitle',['$rootScope','$timeout',function($rootScope,$timeout){return{link:function(scope,element){var listener=function(event,toState){var title='Peon';if(toState.data&&toState.data.pageTitle)title=toState.data.pageTitle;$timeout(function(){element.text(title+"");},0,false);};$rootScope.$on('$stateChangeSuccess',listener);}};}]);app.directive('updateDesc',['$rootScope','$timeout',function($rootScope,$timeout){return{link:function(scope,element){var listener=function(event,toState){var desc="Peon, c'est bon mangez en";if(toState.data&&toState.data.pageDesc)desc=toState.data.pageDesc;$timeout(function(){element.text(desc+"");},0,false);};$rootScope.$on('$stateChangeSuccess',listener);}};}]);app.config(function($stateProvider,$urlRouterProvider,$locationProvider){moment.locale('fr',{months:"janvier_février_mars_avril_mai_juin_juillet_août_septembre_octobre_novembre_décembre".split("_"),monthsShort:"janv._févr._mars_avr._mai_juin_juil._août_sept._oct._nov._déc.".split("_"),weekdays:"dimanche_lundi_mardi_mercredi_jeudi_vendredi_samedi".split("_"),weekdaysShort:"dim._lun._mar._mer._jeu._ven._sam.".split("_"),weekdaysMin:"Di_Lu_Ma_Me_Je_Ve_Sa".split("_"),longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY LT",LLLL:"dddd D MMMM YYYY LT"},calendar:{sameDay:"[Aujourd'hui à] LT",nextDay:'[Demain à] LT',nextWeek:'dddd [à] LT',lastDay:'[Hier à] LT',lastWeek:'dddd [dernier à] LT',sameElse:'L'},relativeTime:{future:"dans %s",past:"il y a %s",s:"quelques secondes",m:"une minute",mm:"%d minutes",h:"une heure",hh:"%d heures",d:"un jour",dd:"%d jours",M:"un mois",MM:"%d mois",y:"une année",yy:"%d ans"},ordinalParse:/\d{1,2}(er| )/,ordinal:function(number){return number+(number===1?'er':'');},meridiemParse:/PD|MD/,isPM:function(input){return input.charAt(0)==='M';},meridiem:function(hours,minutes,isLower){return hours<12?'PD':'MD';},week:{dow:1,doy:4}});$locationProvider.html5Mode({enabled:true,requireBase:false});$urlRouterProvider.when('','/');$locationProvider.hashPrefix('!');$urlRouterProvider.otherwise('/404');console.log($urlRouterProvider);$stateProvider.state('nav',{abstract:true,url:'?{lang:[a-z]{2}}',templateUrl:'templates/nav.html',controller:'navCtrl'}).state('nav.home',{url:'/',templateUrl:'templates/home.html',controller:'homeCtrl',data:{pageTitle:'Home',pageDesc:'Assistant personnel pour auto-entrepreneur. Il vous accompagne dans la gestion de vos clients, devis, factures, calcul de vos cotisations et traitement de vos impayés.'}}).state('nav.faq',{url:'/faq',templateUrl:'templates/faq.html',controller:'faqCtrl',data:{pageTitle:'Faq',pageDesc:"Toutes les questions que vous vous êtes jamais posés sur l'auto-entreprenariat"}}).state('nav.faq.show',{url:'/question/:id',templateUrl:'templates/question.html',controller:'questionCtrl',data:{pageTitle:'Faq',pageDesc:""}}).state('nav.apropos',{url:'/apropos',templateUrl:'templates/apropos.html',controller:'aproposCtrl',data:{pageTitle:'A propos',pageDesc:""}}).state('nav.assistance',{url:'/assistance',templateUrl:'templates/assistance.html',controller:'assistanceCtrl',data:{pageTitle:'Assistance',pageDesc:"Présentation de l'équipe de vrais humains qui vous assisteront dans tous vos besoins."}}).state('nav.blog',{url:'/blog',templateUrl:'templates/blog.html',controller:'blogCtrl',data:{pageTitle:'Blog',pageDesc:"La vie de peon, son histoire, ses coups de coeurs"}}).state('nav.article',{url:'/blog/article/:slug',templateUrl:'templates/article.html',controller:'articleCtrl',data:{pageTitle:'Article'}}).state('nav.cgu',{url:'/cgu',templateUrl:'templates/cgu.html',data:{pageTitle:'Cgu'}}).state('nav.404',{url:'/404',templateUrl:'templates/404.html',controller:'404Ctrl',data:{pageTitle:'404'}}).state('nav.cookies',{url:'/cookies',templateUrl:'templates/cookies.html',data:{pageTitle:'Cookies'}})});angular.module('app').service('LocaleService',function($translate,LOCALES,$rootScope,tmhDynamicLocale){'use strict';var localesObj=LOCALES.locales;var _LOCALES=Object.keys(localesObj);if(!_LOCALES||_LOCALES.length===0){console.error('There are no _LOCALES provided');}
var _LOCALES_DISPLAY_NAMES=[];_LOCALES.forEach(function(locale){_LOCALES_DISPLAY_NAMES.push(localesObj[locale]);});var currentLocale=$translate.proposedLanguage();var checkLocaleIsValid=function(locale){return _LOCALES.indexOf(locale)!==-1;};var setLocale=function(locale){if(!checkLocaleIsValid(locale)){console.error('Locale name "'+locale+'" is invalid');return;}
currentLocale=locale;$translate.use(locale);};$rootScope.$on('$translateChangeSuccess',function(event,data){document.documentElement.setAttribute('lang',data.language);tmhDynamicLocale.set(data.language.toLowerCase().replace(/_/g,'-'));});return{getLocaleDisplayName:function(){return localesObj[currentLocale];},setLocaleByDisplayName:function(localeDisplayName){setLocale(_LOCALES[_LOCALES_DISPLAY_NAMES.indexOf(localeDisplayName)]);},getLocalesDisplayNames:function(){return _LOCALES_DISPLAY_NAMES;}};});app.service('mouseParallaxService',function(){var IE=document.all?true:false
if(!IE)document.captureEvents(Event.MOUSEMOVE)
document.onmousemove=getMouseXY;var tempX=0;var tempY=0;var offsetTop=95;var objectArray=new Array();var windowWidth=document.body.offsetWidth;var windowHeight=document.body.offsetHeight;this.init=function()
{var birdDiv=document.getElementById("welcome");var birdX=windowWidth/2-150;var birdY=windowHeight/2-50;var birdFactor=0.03;var birdArray=new Array();birdArray.push(birdDiv,birdX,birdY,birdFactor);objectArray.push(birdArray);positionDivs();};function getMouseXY(e)
{if(IE)
{tempX=event.clientX+document.body.scrollLeft
tempY=event.clientY+document.body.scrollTop}
else
{tempX=e.pageX
tempY=e.pageY}
if(tempX<0){tempX=0}
if(tempY<0){tempY=0}
moveDiv(tempX);return true}
function moveDiv(tempX)
{for(var i=0;i<objectArray.length;i++)
{var yourDivPositionX=objectArray[i][3]*(0.5*windowWidth-tempX)+objectArray[i][1];objectArray[i][0].style.left=yourDivPositionX+'px';}}
function positionDivs()
{for(var i=0;i<objectArray.length;i++)
{objectArray[i][0].style.left=objectArray[i][1]+"px";}}});app.controller('404Ctrl',function($scope){analytics.page({path:'/404'});});app.controller('aproposCtrl',function($scope){analytics.page({path:'/apropos'});});app.controller('articleCtrl',function($stateParams,$scope,$http,$sce,$timeout){console.log($stateParams);$http.get('https://app.peon.fr/api/posts/slug/'+$stateParams.slug).success(function(data){var article={};article=data;article.content=$sce.trustAsHtml(data.content);article.date=moment(data.publishedAt).format("dddd, Do MMMM YYYY");$scope.article=article;console.log(data);});analytics.page({path:'/blog/'+$stateParams.slug});});app.controller('assistanceCtrl',function($translate,$scope,$http){analytics.page({path:'/assistance'});$scope.isGood=null;$scope.isSended=false;var button=angular.element(document.getElementById('validate'));$scope.sendQuestion=function(form){if(form.$valid)
{console.log(form.email);button.addClass('on');window.analytics.track('Question submitted');$http.post('https://app.peon.fr/api/questions/',{email:form.email,name:form.name,msg:form.content}).success(function(){button.removeClass('on');$scope.isSended=true;$scope.isGood=true;console.log('YEAH');}).error(function(){button.removeClass('on');$scope.isSended=true;$scope.isGood=false;console.log('NOES');});}};});app.controller('blogCtrl',function($scope,$http,$sce,$timeout){$timeout(function(){$timeout=twttr.widgets.load();},100);analytics.page({path:'/blog'});$scope.trackNewsletter=function(){window.analytics.track('NewsLetter add');};$http.get('https://app.peon.fr/api/posts').success(function(data){var articles=[];for(var i=0;i<data.length;i++){var content=data[i].content.substring(0,408);var title=data[i].title;var date=moment(data[i].publishedAt).format("Do MMMM YYYY");var RawDate=data[i].publishedAt;var tags=data[i].tags;var img=data[i].img;var slug=data[i].slug;var isMore=false;if(data[i].content.length>400)
isMore=true;content=$sce.trustAsHtml(content);articles.push({isMore:isMore,index:i,slug:slug,content:content,title:title,date:date,tags:tags,img:img});}
$scope.articles=articles;});$scope.isGood=null;$scope.isSended=false;$scope.sendEmail=function(form){if(form.$valid)
{console.log(form.email);window.analytics.track('NewsLetter add');$http.post('/subscribeToMailchimp/',{email:form.email}).success(function(){$scope.isSended=true;$scope.isGood=true;console.log('YEAH');});}};});app.controller('contactCtrl',function($scope){analytics.page({path:'/contact'});});app.controller('faqCtrl',function($translate,$sce,$stateParams,$scope,$http,$document){analytics.page({path:'/faq'});$scope.moveTo=function(id){var offset=100;var duration=500;var someElement=angular.element(document.getElementById(id));$document.scrollToElement(someElement,offset,duration);}
$scope.isGood=null;$scope.isSended=false;var button=angular.element(document.getElementById('validate'));$scope.sendQuestion=function(form){if(form.$valid)
{console.log(form.email);button.addClass('on');window.analytics.track('Question submitted');$http.post('https://app.peon.fr/api/questions/',{email:form.email,name:form.name,msg:form.content}).success(function(){button.removeClass('on');$scope.isSended=true;$scope.isGood=true;console.log('YEAH');}).error(function(){button.removeClass('on');$scope.isSended=true;$scope.isGood=false;console.log('NOES');});}};analytics.page({path:'/faq/'+$stateParams.id});$scope.trackQuestion=function(index){window.analytics.track('questionApp '+index);};console.log($stateParams);$http.get('https://app.peon.fr/api/infos').success(function(data){var questions=[];for(var i=0;i<data.length;i++){var content=data[i].content;var title=data[i].title;content=$sce.trustAsHtml(content);if(data[i].category===$stateParams.id)
questions.push({index:i,content:content,title:title});}
$scope.questions=questions;console.log(questions);});});app.controller('homeCtrl',function($cookies,$scope,mouseParallaxService,$timeout){$scope.setCookie=false;var favoriteCookie=$cookies.get('cookiePopup');if(favoriteCookie=='true')
$scope.setCookie=true;$scope.updateCookie=function(){$scope.setCookie=true;var expireDate=new Date();expireDate.setDate(expireDate.getDate()+365);$cookies.put('cookiePopup','true',{'expires':expireDate});};$scope.isVideoClicked=false;$scope.videoClickMask=function(){$scope.isVideoClicked=true;window.analytics.track('videoOpened');}
mouseParallaxService.init();$scope.trackCta1=function(){window.analytics.track('cta1');};$scope.trackCta2=function(){window.analytics.track('cta2');};});app.controller('navCtrl',function(LocaleService,$translate,$locale,$scope,$rootScope,$stateParams,$location,$translate){$scope.trackCreate=function(){window.analytics.track('Account Created');};$rootScope.$on('$stateChangeError',function(event){$state.go('nav.404');});});app.controller('questionCtrl',function($translate,$sce,$stateParams,$scope,$http,$document){$scope.moveTo=function(id){var offset=100;var duration=500;var someElement=angular.element(document.getElementById(id));$document.scrollToElement(someElement,offset,duration);}
analytics.page({path:'/faq/'+$stateParams.id});$scope.trackQuestion=function(index){window.analytics.track('questionApp '+index);};console.log($stateParams);$http.get('https://app.peon.fr/api/infos').success(function(data){var questions=[];for(var i=0;i<data.length;i++){var content=data[i].content;var title=data[i].title;content=$sce.trustAsHtml(content);if(data[i].category===$stateParams.id)
questions.push({index:i,content:content,title:title});}
$scope.questions=questions;console.log(questions);});});